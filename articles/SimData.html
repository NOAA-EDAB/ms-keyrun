<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mskeyrun">
<title>Generating Simulated Data • mskeyrun</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generating Simulated Data">
<meta property="og:description" content="mskeyrun">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mskeyrun</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/mskeyrun.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Data Needs</h6>
    <a class="dropdown-item" href="../articles/DataNeeds.html">Project outline</a>
    <a class="dropdown-item" href="../articles/DatasetDimensions.html">Dataset Dimensions</a>
    <a class="dropdown-item" href="../articles/SpeciesEnvDat.html">Keyrun Species, Environment, Data Formats</a>
    <a class="dropdown-item" href="../articles/CompsDat.html">Age, Length, Diet</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Georges Bank</h6>
    <a class="dropdown-item" href="../articles/GBSurveySet.html">GB Survey Footprint</a>
    <a class="dropdown-item" href="../articles/allocateLandingsEPU.html">Allocate Landings to GB</a>
    <a class="dropdown-item" href="../articles/stockAreas.html">Stock areas</a>
    <a class="dropdown-item" href="../articles/GBsurveycatchviz.html">Focal species biomass and catch on GB</a>
    <a class="dropdown-item" href="../articles/GBdietcomp.html">Focal species diets on GB</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Simulated Data</h6>
    <a class="dropdown-item" href="../articles/SimData.html">Generating Simulated Data</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Assigning Fleets</h6>
    <a class="dropdown-item" href="../articles/GBFleetDefinitions.html">Analysis of catch by gear</a>
    <a class="dropdown-item" href="../articles/GBFleetDecisions.html">Fleet Definitions</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Length &amp; Age Based Data</h6>
    <a class="dropdown-item" href="../articles/GBLandingLengthDataSources.html">Data Sources</a>
    <a class="dropdown-item" href="../articles/GBLandingsByLength.html">Landings by Length</a>
    <a class="dropdown-item" href="../articles/GBLandingsByAge.html">Landings by Age</a>
    <a class="dropdown-item" href="../articles/GBLengthWeight.html">Length Weight Relationships</a>
    <a class="dropdown-item" href="../articles/GBbiomassNumbyLength.html">Survey Biomass and Abundance</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/NOAA-EDAB/ms-keyrun/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Generating Simulated Data</h1>
                        <h4 data-toc-skip class="author">Sarah
Gaichas</h4>
            
            <h4 data-toc-skip class="date">04 November, 2022</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/NOAA-EDAB/ms-keyrun/blob/HEAD/vignettes/SimData.Rmd" class="external-link"><code>vignettes/SimData.Rmd</code></a></small>
      <div class="d-none name"><code>SimData.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="simulating-input-data-from-an-ecosystem-model">Simulating input data from an ecosystem model<a class="anchor" aria-label="anchor" href="#simulating-input-data-from-an-ecosystem-model"></a>
</h2>
<p>Here we use existing <a href="https://github.com/Atlantis-Ecosystem-Model/Atlantis_example_and_instructions" class="external-link">Atlantis</a>
ecosystem model output to generate input datasets for a variety of
simpler population models, so that the performance of these models can
be evaluated against known (simulated) ecosystem dynamics. Atlantis is
an end-to-end spatial ecosystem model capable of including climate
effects, seasonal migration, food web, and fishery interactions <span class="citation">(Audzijonyte et al., 2019)</span>.</p>
<p>We extract simulated data using the R package <a href="https://github.com/r4atlantis/atlantisom" class="external-link"><code>atlantisom</code></a>.
The purpose of <code>atlantisom</code> is to use existing Atlantis model
output to generate input datasets for a variety of models, so that the
performance of these models can be evaluated against known (simulated)
ecosystem dynamics. The process is briefly described <a href="https://sgaichas.github.io/poseidon-dev/atlantisom_landingpage.html" class="external-link">here</a>.
Atlantis models can be run using different climate forcing, fishing, and
other scenarios. Users of <code>atlantisom</code> specify fishery
independent and fishery dependent sampling in space and time, as well as
species-specific catchability, selectivty, and other observation
processes for any Atlantis scenario. Internally consistent multispecies
and ecosystem datasets with known observation error characteristics are
<code>atlantisom</code> outputs, for use in individual model performance
testing, comparing performance of alternative models, and performance
testing of model ensembles against “true” Atlantis outputs.</p>
<p>The simulated dataset is based on output of the Norwegian and Barents
Sea (NOBA) Atlantis model <span class="citation">(Hansen et al., 2019,
2016)</span>. The simulated dataset contains comparable survey, fishery,
and composition data as the Georges Bank dataset, but the time series
span 80 simulation years and include 11 species. This dataset was used
for initial model development, code quality testing, and model skill
assessment by the modeling teams. Details of the dataset including
construction and basic attributes are below.</p>
</div>
<div class="section level2">
<h2 id="species-in-the-ms-keyrun-dataset">Species in the ms-keyrun dataset<a class="anchor" aria-label="anchor" href="#species-in-the-ms-keyrun-dataset"></a>
</h2>
<p>Our initial species selection includes 11 single species groups from
the Atlantis NOBA model.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lname</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Name<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Long_rough_dab"</span>,</span>
<span>                                 <span class="st">"Green_halibut"</span>,</span>
<span>                                 <span class="st">"Mackerel"</span>,</span>
<span>                                 <span class="st">"Haddock"</span>,</span>
<span>                                 <span class="st">"Saithe"</span>,</span>
<span>                                 <span class="st">"Redfish"</span>,</span>
<span>                                 <span class="st">"Blue_whiting"</span>,</span>
<span>                                 <span class="st">"Norwegian_ssh"</span>,</span>
<span>                                 <span class="st">"North_atl_cod"</span>,</span>
<span>                                 <span class="st">"Polar_cod"</span>,</span>
<span>                                 <span class="st">"Capelin"</span><span class="op">)</span>,</span>
<span>                    Long.Name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Long rough dab"</span>,</span>
<span>                                 <span class="st">"Greenland halibut"</span>,</span>
<span>                                 <span class="st">"Mackerel"</span>,</span>
<span>                                 <span class="st">"Haddock"</span>,</span>
<span>                                 <span class="st">"Saithe"</span>,</span>
<span>                                 <span class="st">"Redfish"</span>,</span>
<span>                                 <span class="st">"Blue whiting"</span>,</span>
<span>                                 <span class="st">"Norwegian spring spawning herring"</span>,</span>
<span>                                 <span class="st">"Northeast Atlantic Cod"</span>,</span>
<span>                                 <span class="st">"Polar cod"</span>,</span>
<span>                                 <span class="st">"Capelin"</span><span class="op">)</span>,</span>
<span>                    Latin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"*Hippoglossoides platessoides*"</span>,</span>
<span>                              <span class="st">"*Reinhardtius hippoglossoides*"</span>,</span>
<span>                              <span class="st">"*Scomber scombrus*"</span>,</span>
<span>                              <span class="st">"*Melongrammus aeglefinus*"</span>,</span>
<span>                              <span class="st">"*Pollachius virens*"</span>,</span>
<span>                              <span class="st">"*Sebastes mentella*"</span>,</span>
<span>                              <span class="st">"*Micromesistius poutassou*"</span>,</span>
<span>                              <span class="st">"*Clupea harengus*"</span>,</span>
<span>                              <span class="st">"*Gadus morhua*"</span>,</span>
<span>                              <span class="st">"*Boreogadus saida*"</span>,</span>
<span>                              <span class="st">"*Mallotus villosus*"</span><span class="op">)</span>,</span>
<span>                    Code <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LRD"</span>, <span class="st">"GRH"</span>, <span class="st">"MAC"</span>, <span class="st">"HAD"</span>, <span class="st">"SAI"</span>, <span class="st">"RED"</span>, </span>
<span>                             <span class="st">"BWH"</span>, <span class="st">"SSH"</span>, <span class="st">"NCO"</span>, <span class="st">"PCO"</span>, <span class="st">"CAP"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># sppsubset &lt;- merge(fgs, lname, all.y = TRUE)</span></span>
<span><span class="co"># spptable &lt;- sppsubset %&gt;% </span></span>
<span><span class="co">#   arrange(Index) %&gt;%</span></span>
<span><span class="co">#   select(Name, Long.Name, Latin)</span></span>
<span></span>
<span><span class="va">spptable</span> <span class="op">&lt;-</span> <span class="va">lname</span> <span class="op">%&gt;%</span></span>
<span>   <span class="fu">select</span><span class="op">(</span><span class="va">Name</span>, <span class="va">Long.Name</span>, <span class="va">Latin</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">spptable</span>, col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Model name"</span>, <span class="st">"Full name"</span>, <span class="st">"Latin name"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="18%">
<col width="42%">
<col width="38%">
</colgroup>
<thead><tr class="header">
<th align="left">Model name</th>
<th align="left">Full name</th>
<th align="left">Latin name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Long_rough_dab</td>
<td align="left">Long rough dab</td>
<td align="left"><em>Hippoglossoides platessoides</em></td>
</tr>
<tr class="even">
<td align="left">Green_halibut</td>
<td align="left">Greenland halibut</td>
<td align="left"><em>Reinhardtius hippoglossoides</em></td>
</tr>
<tr class="odd">
<td align="left">Mackerel</td>
<td align="left">Mackerel</td>
<td align="left"><em>Scomber scombrus</em></td>
</tr>
<tr class="even">
<td align="left">Haddock</td>
<td align="left">Haddock</td>
<td align="left"><em>Melongrammus aeglefinus</em></td>
</tr>
<tr class="odd">
<td align="left">Saithe</td>
<td align="left">Saithe</td>
<td align="left"><em>Pollachius virens</em></td>
</tr>
<tr class="even">
<td align="left">Redfish</td>
<td align="left">Redfish</td>
<td align="left"><em>Sebastes mentella</em></td>
</tr>
<tr class="odd">
<td align="left">Blue_whiting</td>
<td align="left">Blue whiting</td>
<td align="left"><em>Micromesistius poutassou</em></td>
</tr>
<tr class="even">
<td align="left">Norwegian_ssh</td>
<td align="left">Norwegian spring spawning herring</td>
<td align="left"><em>Clupea harengus</em></td>
</tr>
<tr class="odd">
<td align="left">North_atl_cod</td>
<td align="left">Northeast Atlantic Cod</td>
<td align="left"><em>Gadus morhua</em></td>
</tr>
<tr class="even">
<td align="left">Polar_cod</td>
<td align="left">Polar cod</td>
<td align="left"><em>Boreogadus saida</em></td>
</tr>
<tr class="odd">
<td align="left">Capelin</td>
<td align="left">Capelin</td>
<td align="left"><em>Mallotus villosus</em></td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="generating-a-dataset">Generating a dataset<a class="anchor" aria-label="anchor" href="#generating-a-dataset"></a>
</h2>
<div class="section level3">
<h3 id="configuration-files-specified-once">Configuration files specified once<a class="anchor" aria-label="anchor" href="#configuration-files-specified-once"></a>
</h3>
<p><code>NOBA2config.R</code> specifies location and names of files
needed for atlantisom to initialize:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d.name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"simulated-data/atlantisoutput"</span>,<span class="st">"NOBA_sacc_38"</span><span class="op">)</span></span>
<span><span class="va">functional.groups.file</span> <span class="op">&lt;-</span> <span class="st">"nordic_groups_v04.csv"</span></span>
<span><span class="va">biomass.pools.file</span> <span class="op">&lt;-</span> <span class="st">"nordic_biol_v23.nc"</span></span>
<span><span class="va">biol.prm.file</span> <span class="op">&lt;-</span> <span class="st">"nordic_biol_incl_harv_v_011_1skg.prm"</span></span>
<span><span class="va">box.file</span> <span class="op">&lt;-</span> <span class="st">"Nordic02.bgm"</span></span>
<span><span class="va">initial.conditions.file</span> <span class="op">&lt;-</span> <span class="st">"nordic_biol_v23.nc"</span></span>
<span><span class="va">run.prm.file</span> <span class="op">&lt;-</span> <span class="st">"nordic_run_v01.xml"</span></span>
<span><span class="va">scenario.name</span> <span class="op">&lt;-</span> <span class="st">"nordic_runresults_01"</span></span>
<span><span class="va">bioind.file</span> <span class="op">&lt;-</span> <span class="st">"nordic_runresults_01BiomIndx.txt"</span></span>
<span><span class="va">catch.file</span> <span class="op">&lt;-</span> <span class="st">"nordic_runresults_01Catch.txt"</span></span>
<span><span class="va">annage</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span><span class="va">fisheries.file</span> <span class="op">&lt;-</span> <span class="st">"NoBAFisheries.csv"</span></span></code></pre></div>
<p><code>omdimensions.R</code> standardizes timesteps, etc. (this is
part of atlantisom and should not need to be changed by the user):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#survey species inherited from omlist_ss</span></span>
<span><span class="va">survspp</span> <span class="op">&lt;-</span> <span class="va">omlist_ss</span><span class="op">$</span><span class="va">species_ss</span></span>
<span><span class="co"># survey season and other time dimensioning parameters</span></span>
<span><span class="co"># generalized timesteps all models</span></span>
<span><span class="va">noutsteps</span> <span class="op">&lt;-</span> <span class="va">omlist_ss</span><span class="op">$</span><span class="va">runpar</span><span class="op">$</span><span class="va">tstop</span><span class="op">/</span><span class="va">omlist_ss</span><span class="op">$</span><span class="va">runpar</span><span class="op">$</span><span class="va">outputstep</span></span>
<span><span class="va">timeall</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="va">noutsteps</span><span class="op">)</span></span>
<span><span class="va">stepperyr</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">omlist_ss</span><span class="op">$</span><span class="va">runpar</span><span class="op">$</span><span class="va">outputstepunit</span><span class="op">==</span><span class="st">"days"</span><span class="op">)</span> <span class="fl">365</span><span class="op">/</span><span class="va">omlist_ss</span><span class="op">$</span><span class="va">runpar</span><span class="op">$</span><span class="va">toutinc</span></span>
<span><span class="va">midptyr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">stepperyr</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># model areas, subset in surveyconfig</span></span>
<span><span class="va">allboxes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">omlist_ss</span><span class="op">$</span><span class="va">boxpars</span><span class="op">$</span><span class="va">nbox</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fishery output: learned the hard way this can be different from ecosystem outputs</span></span>
<span><span class="va">fstepperyr</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">omlist_ss</span><span class="op">$</span><span class="va">runpar</span><span class="op">$</span><span class="va">outputstepunit</span><span class="op">==</span><span class="st">"days"</span><span class="op">)</span> <span class="fl">365</span><span class="op">/</span><span class="va">omlist_ss</span><span class="op">$</span><span class="va">runpar</span><span class="op">$</span><span class="va">toutfinc</span></span>
<span></span>
<span><span class="co"># survey selectivity (agecl based)</span></span>
<span><span class="va">sp_age</span> <span class="op">&lt;-</span> <span class="va">omlist_ss</span><span class="op">$</span><span class="va">funct.group_ss</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Name"</span>, <span class="st">"NumCohorts"</span>, <span class="st">"NumAgeClassSize"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># should return all age classes fully sampled (Atlantis output is 10 age groups per spp)</span></span>
<span><span class="va">n_age_classes</span> <span class="op">&lt;-</span> <span class="va">sp_age</span><span class="op">$</span><span class="va">NumCohorts</span></span>
<span><span class="co"># changed below for multiple species NOTE survspp alphabetical; NOT in order of fgs!!</span></span>
<span><span class="co"># this gives correct names</span></span>
<span><span class="va">age_classes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">n_age_classes</span>, <span class="va">seq</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">age_classes</span><span class="op">)</span><span class="op">&lt;-</span><span class="va">sp_age</span><span class="op">$</span><span class="va">Name</span></span>
<span></span>
<span><span class="va">n_annages</span> <span class="op">&lt;-</span> <span class="va">sp_age</span><span class="op">$</span><span class="va">NumCohorts</span> <span class="op">*</span> <span class="va">sp_age</span><span class="op">$</span><span class="va">NumAgeClassSize</span></span>
<span><span class="co"># changed below for multiple species</span></span>
<span><span class="va">annages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">n_annages</span>, <span class="va">seq</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">annages</span><span class="op">)</span><span class="op">&lt;-</span><span class="va">sp_age</span><span class="op">$</span><span class="va">Name</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="change-these-survey-and-fishery-config-files">Change these survey and fishery config files<a class="anchor" aria-label="anchor" href="#change-these-survey-and-fishery-config-files"></a>
</h3>
<p><code>mssurvey_spring.R</code> and <code>mssurvey_fall.R</code>
configure the fishery independent surveys (in this census test, surveys
sample all model polygons in all years and have efficiency of 1 for all
species, with no size selectivity):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Default survey configuration here has a range of efficiencies and selectivities</span></span>
<span><span class="co"># To emulate a range of species in a single multispecies survey</span></span>
<span><span class="co"># Also now happens in "spring" and "fall"</span></span>
<span><span class="co"># Need to define survey season, area, efficiency, selectivity</span></span>
<span></span>
<span><span class="co"># Survey name</span></span>
<span><span class="va">survey.name</span><span class="op">=</span><span class="st">"BTS_spring_allbox_effic1"</span></span>
<span></span>
<span><span class="co">#Atlantis model timestep corresponding to the true output--now from census_spec.R</span></span>
<span><span class="va">timestep</span> <span class="op">&lt;-</span> <span class="va">stepperyr</span> <span class="co">#5</span></span>
<span></span>
<span><span class="co">#Which atlantis timestep does the survey run in?--now from census_spec.R</span></span>
<span><span class="co"># with 5 output steps per year, 0 is Jan-Feb-midMar, 1 is midMar-Apr-May, </span></span>
<span><span class="co"># 2 is June-July-midAug, 3 is midAug-Sept-Oct, 4 is Nov-Dec (ish)</span></span>
<span></span>
<span><span class="co"># No, timestep 0 is initial condition and should be ignored to align </span></span>
<span><span class="co"># snapshots (biomass, numbers) with</span></span>
<span><span class="co"># cumulative outputs (fishery catch, numbers)</span></span>
<span></span>
<span><span class="co"># with 5 output steps per (non leap) year:</span></span>
<span><span class="co"># 1 is day 73, or 14 March</span></span>
<span><span class="co"># 2 is day 146, or 26 May</span></span>
<span><span class="co"># 3 is day 219, or 7 August</span></span>
<span><span class="co"># 4 is day 292, or 19 October</span></span>
<span><span class="co"># 5 is day 365, or 31 December</span></span>
<span></span>
<span><span class="va">survey_sample_time</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># spring survey</span></span>
<span></span>
<span><span class="co">#The last timestep to sample</span></span>
<span><span class="va">total_sample</span> <span class="op">&lt;-</span> <span class="va">noutsteps</span><span class="op">-</span><span class="fl">1</span> <span class="co">#495</span></span>
<span></span>
<span><span class="co">#Vector of indices of survey times to pull</span></span>
<span><span class="va">survey_sample_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">survey_sample_time</span>,</span>
<span>                          <span class="va">total_sample</span>, by<span class="op">=</span><span class="va">timestep</span><span class="op">)</span></span>
<span></span>
<span><span class="va">survtime</span> <span class="op">&lt;-</span> <span class="va">survey_sample_full</span></span>
<span></span>
<span><span class="co"># survey area</span></span>
<span><span class="co"># should return all model areas</span></span>
<span><span class="va">survboxes</span> <span class="op">&lt;-</span> <span class="va">allboxes</span></span>
<span></span>
<span><span class="co"># survey efficiency (q)</span></span>
<span><span class="co"># should return a perfectly efficient survey </span></span>
<span><span class="va">surveffic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species<span class="op">=</span><span class="va">survspp</span>,</span>
<span>                     efficiency<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1.0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">survspp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># survey selectivity (agecl based)</span></span>
<span><span class="co"># this is by age class, need to change to use with ANNAGEBIO output</span></span>
<span><span class="co">#survselex &lt;- data.frame(species=rep(names(age_classes), each=n_age_classes),</span></span>
<span><span class="co">#                     agecl=rep(c(1:n_age_classes),length(survspp)),</span></span>
<span><span class="co">#                     selex=rep(1.0,length(survspp)*n_age_classes))</span></span>
<span></span>
<span><span class="co"># for annage output uses names(annages) NOT alphabetical survspp</span></span>
<span><span class="va">survselex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">annages</span><span class="op">)</span>, <span class="va">n_annages</span><span class="op">)</span>, <span class="co">#  </span></span>
<span>                        agecl<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">n_annages</span>,<span class="va">seq</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        selex<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1.0</span>,<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n_annages</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">survselex.agecl</span> <span class="op">&lt;-</span> <span class="va">survselex</span></span>
<span></span>
<span></span>
<span><span class="co"># effective sample size needed for sample_fish</span></span>
<span><span class="co"># this effective N is high but not equal to total for numerous groups</span></span>
<span><span class="va">surveffN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species<span class="op">=</span><span class="va">survspp</span>, effN<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100000</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">survspp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># survey index cv needed for sample_survey_xxx</span></span>
<span><span class="co"># cv = 0.1</span></span>
<span><span class="va">surv_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species<span class="op">=</span><span class="va">survspp</span>, cv<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">survspp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># length at age cv for input into calc_age2length function</span></span>
<span><span class="co"># function designed to take one cv for all species, need to change to pass it a vector</span></span>
<span><span class="va">lenage_cv</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span></span>
<span><span class="co"># max size bin for length estimation, function defaults to 150 cm if not supplied</span></span>
<span><span class="va">maxbin</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span></span>
<span><span class="co"># diet sampling parameters</span></span>
<span><span class="va">alphamult</span> <span class="op">&lt;-</span> <span class="fl">10000000</span></span>
<span><span class="va">unidprey</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Default survey configuration here has a range of efficiencies and selectivities</span></span>
<span><span class="co"># To emulate a range of species in a single multispecies survey</span></span>
<span><span class="co"># Also now happens in "spring" and "fall"</span></span>
<span><span class="co"># Need to define survey season, area, efficiency, selectivity</span></span>
<span></span>
<span><span class="co"># Survey name</span></span>
<span><span class="va">survey.name</span><span class="op">=</span><span class="st">"BTS_fall_allbox_effic1"</span></span>
<span></span>
<span><span class="co">#Atlantis model timestep corresponding to the true output--now from census_spec.R</span></span>
<span><span class="va">timestep</span> <span class="op">&lt;-</span> <span class="va">stepperyr</span> <span class="co">#5</span></span>
<span></span>
<span><span class="co">#Which atlantis timestep does the survey run in?--now from census_spec.R</span></span>
<span><span class="co"># with 5 output steps per year, 0 is Jan-Feb-midMar, 1 is midMar-Apr-May, </span></span>
<span><span class="co"># 2 is June-July-midAug, 3 is midAug-Sept-Oct, 4 is Nov-Dec (ish)</span></span>
<span></span>
<span><span class="co"># No, timestep 0 is initial condition and should be ignored to align </span></span>
<span><span class="co"># snapshots (biomass, numbers) with</span></span>
<span><span class="co"># cumulative outputs (fishery catch, numbers)</span></span>
<span></span>
<span><span class="co"># with 5 output steps per (non leap) year:</span></span>
<span><span class="co"># 1 is day 73, or 14 March</span></span>
<span><span class="co"># 2 is day 146, or 26 May</span></span>
<span><span class="co"># 3 is day 219, or 7 August</span></span>
<span><span class="co"># 4 is day 292, or 19 October</span></span>
<span><span class="co"># 5 is day 365, or 31 December</span></span>
<span></span>
<span><span class="va">survey_sample_time</span> <span class="op">&lt;-</span> <span class="fl">3</span> <span class="co"># fall survey</span></span>
<span></span>
<span><span class="co">#The last timestep to sample</span></span>
<span><span class="va">total_sample</span> <span class="op">&lt;-</span> <span class="va">noutsteps</span><span class="op">-</span><span class="fl">1</span> <span class="co">#495</span></span>
<span></span>
<span><span class="co">#Vector of indices of survey times to pull</span></span>
<span><span class="va">survey_sample_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">survey_sample_time</span>,</span>
<span>                          <span class="va">total_sample</span>, by<span class="op">=</span><span class="va">timestep</span><span class="op">)</span></span>
<span></span>
<span><span class="va">survtime</span> <span class="op">&lt;-</span> <span class="va">survey_sample_full</span></span>
<span></span>
<span><span class="co"># survey area</span></span>
<span><span class="co"># should return all model areas</span></span>
<span><span class="va">survboxes</span> <span class="op">&lt;-</span> <span class="va">allboxes</span></span>
<span></span>
<span><span class="co"># survey efficiency (q)</span></span>
<span><span class="co"># should return a perfectly efficient survey </span></span>
<span><span class="va">surveffic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species<span class="op">=</span><span class="va">survspp</span>,</span>
<span>                     efficiency<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1.0</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">survspp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># survey selectivity (agecl based)</span></span>
<span><span class="co"># this is by age class, need to change to use with ANNAGEBIO output</span></span>
<span><span class="co">#survselex &lt;- data.frame(species=rep(survspp, each=n_age_classes),</span></span>
<span><span class="co">#                     agecl=rep(c(1:n_age_classes),length(survspp)),</span></span>
<span><span class="co">#                     selex=rep(1.0,length(survspp)*n_age_classes))</span></span>
<span></span>
<span><span class="co"># for annage output</span></span>
<span><span class="va">survselex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">annages</span><span class="op">)</span>, <span class="va">n_annages</span><span class="op">)</span>, <span class="co">#  </span></span>
<span>                        agecl<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">n_annages</span>,<span class="va">seq</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                        selex<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1.0</span>,<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n_annages</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">survselex.agecl</span> <span class="op">&lt;-</span> <span class="va">survselex</span> </span>
<span></span>
<span></span>
<span><span class="co"># effective sample size needed for sample_fish</span></span>
<span><span class="co"># this effective N is high but not equal to total for numerous groups</span></span>
<span><span class="va">surveffN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species<span class="op">=</span><span class="va">survspp</span>, effN<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100000</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">survspp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># survey index cv needed for sample_survey_xxx</span></span>
<span><span class="co"># cv = 0.1</span></span>
<span><span class="va">surv_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species<span class="op">=</span><span class="va">survspp</span>, cv<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">survspp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># length at age cv for input into calc_age2length function</span></span>
<span><span class="co"># function designed to take one cv for all species, need to change to pass it a vector</span></span>
<span><span class="va">lenage_cv</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span></span>
<span><span class="co"># max size bin for length estimation, function defaults to 150 cm if not supplied</span></span>
<span><span class="va">maxbin</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span></span>
<span><span class="co"># diet sampling parameters</span></span>
<span><span class="va">alphamult</span> <span class="op">&lt;-</span> <span class="fl">10000000</span></span>
<span><span class="va">unidprey</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></code></pre></div>
<p><code>msfishery.R</code> configures the fishery dependent data:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Default fishery configuration here is a census</span></span>
<span><span class="va">fishery.name</span><span class="op">=</span><span class="st">"census"</span></span>
<span></span>
<span><span class="co"># Inherits species from input omlist_ss</span></span>
<span><span class="va">fishspp</span> <span class="op">&lt;-</span> <span class="va">omlist_ss</span><span class="op">$</span><span class="va">species_ss</span> </span>
<span></span>
<span><span class="co">#Number of years of data to pull</span></span>
<span><span class="va">nyears</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span></span>
<span><span class="co">#Atlantis initialization period in years</span></span>
<span><span class="va">burnin</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span></span>
<span><span class="co"># fishery output: learned the hard way this can be different from ecosystem outputs</span></span>
<span><span class="va">fstepperyr</span> <span class="op">&lt;-</span> <span class="kw">if</span><span class="op">(</span><span class="va">omlist_ss</span><span class="op">$</span><span class="va">runpar</span><span class="op">$</span><span class="va">outputstepunit</span><span class="op">==</span><span class="st">"days"</span><span class="op">)</span> <span class="fl">365</span><span class="op">/</span><span class="va">omlist_ss</span><span class="op">$</span><span class="va">runpar</span><span class="op">$</span><span class="va">toutfinc</span></span>
<span></span>
<span></span>
<span><span class="co"># same time dimensioning parameters as in surveycensus.R</span></span>
<span><span class="co">#Vector of indices of catch in numbers to pull (by timestep to sum)</span></span>
<span><span class="va">fish_sample_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="va">total_sample</span><span class="op">)</span>  <span class="co">#total_sample defined in sardinesurvey.R</span></span>
<span><span class="va">fish_burnin</span> <span class="op">&lt;-</span> <span class="va">burnin</span><span class="op">*</span><span class="va">fstepperyr</span><span class="op">+</span><span class="fl">1</span></span>
<span><span class="va">fish_nyears</span> <span class="op">&lt;-</span> <span class="va">nyears</span><span class="op">*</span><span class="va">fstepperyr</span></span>
<span><span class="va">fish_times</span> <span class="op">&lt;-</span> <span class="va">fish_sample_full</span><span class="op">[</span><span class="va">fish_burnin</span><span class="op">:</span><span class="op">(</span><span class="va">fish_burnin</span><span class="op">+</span><span class="va">fish_nyears</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">fish_timesteps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">fish_times</span><span class="op">[</span><span class="va">fstepperyr</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">fish_times</span><span class="op">)</span>, by<span class="op">=</span><span class="va">fstepperyr</span><span class="op">)</span> <span class="co">#last timestep</span></span>
<span><span class="co">#fish_years &lt;- unique(floor(fish_times/fstepperyr)+1) # my original</span></span>
<span><span class="va">fish_years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">fish_times</span><span class="op">/</span><span class="va">fstepperyr</span><span class="op">)</span><span class="op">)</span> <span class="co">#from Christine's new sardine_config.R</span></span>
<span></span>
<span><span class="va">fishtime</span> <span class="op">&lt;-</span> <span class="va">fish_times</span></span>
<span></span>
<span></span>
<span><span class="co"># fishery sampling area</span></span>
<span><span class="co"># should return all model areas, this assumes you see everything that it caught</span></span>
<span><span class="va">fishboxes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">omlist_ss</span><span class="op">$</span><span class="va">boxpars</span><span class="op">$</span><span class="va">nbox</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># effective sample size needed for sample_fish</span></span>
<span><span class="co"># this effective N is divided by the number of annual timesteps below, so 200 per time</span></span>
<span><span class="co"># use as input to the length samples, ages can be a subset</span></span>
<span><span class="va">fisheffN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species<span class="op">=</span><span class="va">survspp</span>, effN<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">survspp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#this adjusts for subannual fishery output so original effN is for whole year</span></span>
<span><span class="va">fisheffN</span><span class="op">$</span><span class="va">effN</span> <span class="op">&lt;-</span> <span class="va">fisheffN</span><span class="op">$</span><span class="va">effN</span><span class="op">/</span><span class="va">fstepperyr</span> </span>
<span></span>
<span><span class="co"># fishery catch cv can be used in sample_survey_biomass</span></span>
<span><span class="co"># perfect observation</span></span>
<span><span class="va">fish_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species<span class="op">=</span><span class="va">survspp</span>, cv<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">survspp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-atlantisom-and-save-outputs">Run atlantisom and save outputs<a class="anchor" aria-label="anchor" href="#run-atlantisom-and-save-outputs"></a>
</h3>
<p>True datasets are generated as follows, using <code>atlantisom</code>
wrapper functions <code>om_init</code> to assemble initial true atlantis
data, <code>om_species</code> to subset true data for desired species,
<code>om_index</code> to generate survey biomass and total catch biomass
indices, <code>om_comps</code> to generate age and length compositions
and average weight at age from surveys and fisheries, and
<code>om_diet</code> to generate diet from surveys. Outputs are saved to
the <code>atlantisoutput</code> folder (not kept on github due to
size):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NOBAom</span> <span class="op">&lt;-</span> <span class="fu">om_init</span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"simulated-data/config/NOBA_sacc38Config.R"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">NOBAom_ms</span> <span class="op">&lt;-</span> <span class="fu">om_species</span><span class="op">(</span><span class="va">sppsubset</span><span class="op">$</span><span class="va">Name</span>, <span class="va">NOBAom</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#need to change internal call to source in atlantisom om_index om_comps and om_diet functions</span></span>
<span><span class="co">#expecting a config folder in same directory as rmd</span></span>
<span><span class="co">#this is a workaround</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"docs/config"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"simulated-data/config/omdimensions.R"</span><span class="op">)</span>, <span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"docs/config/omdimensions.R"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">NOBAom_ms_ind</span> <span class="op">&lt;-</span> <span class="fu">om_index</span><span class="op">(</span>usersurvey <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"simulated-data/config/mssurvey_spring.R"</span><span class="op">)</span>, </span>
<span>                                         <span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"simulated-data/config/mssurvey_fall.R"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                           userfishery <span class="op">=</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"simulated-data/config/msfishery.R"</span><span class="op">)</span>,</span>
<span>                           omlist_ss <span class="op">=</span> <span class="va">NOBAom_ms</span>, </span>
<span>                           n_reps <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                           save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">NOBAom_ms_comp</span> <span class="op">&lt;-</span> <span class="fu">om_comps</span><span class="op">(</span>usersurvey <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"simulated-data/config/mssurvey_spring.R"</span><span class="op">)</span>, </span>
<span>                                         <span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"simulated-data/config/mssurvey_fall.R"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                           userfishery <span class="op">=</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"simulated-data/config/msfishery.R"</span><span class="op">)</span>,</span>
<span>                           omlist_ss <span class="op">=</span> <span class="va">NOBAom_ms</span>, </span>
<span>                           n_reps <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                           save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">NOBAom_ms_diet</span> <span class="op">&lt;-</span> <span class="fu">om_diet</span><span class="op">(</span>config <span class="op">=</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"simulated-data/config"</span>, <span class="st">"NOBA2config.R"</span><span class="op">)</span>,</span>
<span>                          dietfile <span class="op">=</span> <span class="st">"NOBADetDiet.gz"</span>,</span>
<span>                          usersurvey <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"simulated-data/config/mssurvey_spring.R"</span><span class="op">)</span>, </span>
<span>                                         <span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"simulated-data/config/mssurvey_fall.R"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                          omlist_ss <span class="op">=</span> <span class="va">NOBAom_ms</span>, </span>
<span>                          n_reps <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                          save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"docs/config"</span><span class="op">)</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-mskeyrun-simulated-data">Create mskeyrun simulated data<a class="anchor" aria-label="anchor" href="#create-mskeyrun-simulated-data"></a>
</h3>
<p>Scripts in <code>ms-keyrun/data-raw</code> show the process of making
mskeyun datasets from <code>atlantisom</code> output generated above.
Atlantis outputs and <code>atlantisom</code> outputs produced above are
local to Sarah’s computer for this code to run, as they are too large
for github. However, the scripts are linked here to show the process.
Overall this script creates all datasets using functions specific to
each data type:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Sarah's notes for building simulated dataset</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' all atlantis files are local on my computer in folder</span></span>
<span><span class="co">#' ms-keyrun/simlulated-data/atlantisoutput</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' see SimData.Rmd for how these are generated using atlantisom</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' to make data for package</span></span>
<span><span class="co">#' source these files in data-raw/R:</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' create_sim_focal_species.R</span></span>
<span><span class="co">#' get_sim_survey_index.R</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' run from ms-keyrun directory</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">atlmod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"data-raw/simulated-data/config/NOBA_sacc38Config.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">create_sim_focal_species</span><span class="op">(</span><span class="va">atlmod</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">create_sim_biolpar</span><span class="op">(</span><span class="va">atlmod</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">create_sim_survey_index</span><span class="op">(</span><span class="va">atlmod</span>, fitstart<span class="op">=</span><span class="fl">40</span>, fitend<span class="op">=</span><span class="fl">120</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">create_sim_fishery_index</span><span class="op">(</span><span class="va">atlmod</span>, fitstart<span class="op">=</span><span class="fl">40</span>, fitend<span class="op">=</span><span class="fl">120</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">create_sim_survey_agecomp</span><span class="op">(</span><span class="va">atlmod</span>, fitstart<span class="op">=</span><span class="fl">40</span>, fitend<span class="op">=</span><span class="fl">120</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">create_sim_fishery_agecomp</span><span class="op">(</span><span class="va">atlmod</span>, fitstart<span class="op">=</span><span class="fl">40</span>, fitend<span class="op">=</span><span class="fl">120</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">create_sim_survey_lencomp</span><span class="op">(</span><span class="va">atlmod</span>, fitstart<span class="op">=</span><span class="fl">40</span>, fitend<span class="op">=</span><span class="fl">120</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">create_sim_fishery_lencomp</span><span class="op">(</span><span class="va">atlmod</span>, fitstart<span class="op">=</span><span class="fl">40</span>, fitend<span class="op">=</span><span class="fl">120</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">create_sim_survey_dietcomp</span><span class="op">(</span><span class="va">atlmod</span>, fitstart<span class="op">=</span><span class="fl">40</span>, fitend<span class="op">=</span><span class="fl">120</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">create_sim_survey_bottemp</span><span class="op">(</span><span class="va">atlmod</span>, fitstart<span class="op">=</span><span class="fl">40</span>, fitend<span class="op">=</span><span class="fl">120</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">create_sim_fishery_wtage</span><span class="op">(</span><span class="va">atlmod</span>, fitstart<span class="op">=</span><span class="fl">40</span>, fitend<span class="op">=</span><span class="fl">120</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">create_sim_survey_wtage</span><span class="op">(</span><span class="va">atlmod</span>, fitstart<span class="op">=</span><span class="fl">40</span>, fitend<span class="op">=</span><span class="fl">120</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">create_sim_survey_agelen</span><span class="op">(</span><span class="va">atlmod</span>, fitstart<span class="op">=</span><span class="fl">40</span>, fitend<span class="op">=</span><span class="fl">120</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">create_sim_percapconsumption</span><span class="op">(</span><span class="va">atlmod</span>, fitstart<span class="op">=</span><span class="fl">40</span>, fitend<span class="op">=</span><span class="fl">120</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">create_sim_startpars</span><span class="op">(</span><span class="va">atlmod</span>, fitstart<span class="op">=</span><span class="fl">40</span>, fitend<span class="op">=</span><span class="fl">120</span><span class="op">)</span></span></code></pre></div>
<p>For example, <code>create_sim_survey_index()</code> takes the saved
<code>atlantisom</code> output plus user specifications for fit start
and end years to produce the dataset
<code><a href="../reference/simSurveyIndex.html">mskeyrun::simSurveyIndex</a></code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Read in survey data save as rda</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' atlantosom output is accessed and surveys pulled over time</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#'@param atlmod configuration file specifying Atlantis simulation model filenames </span></span>
<span><span class="co">#'and locations  </span></span>
<span><span class="co">#'@param saveToData Boolean. Export to data folder (Default = T)</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#'@return A tibble (Also written to \code{data} folder)</span></span>
<span><span class="co">#'\item{ModSim}{Atlantis model name and simulation id}</span></span>
<span><span class="co">#'\item{year}{year simulated survey conducted}</span></span>
<span><span class="co">#'\item{Code}{Atlantis model three letter code for functional group}</span></span>
<span><span class="co">#'\item{Name}{Atlantis model common name for functional group}</span></span>
<span><span class="co">#'\item{survey}{simulated survey name}</span></span>
<span><span class="co">#'\item{variable}{biomass or coefficient of variation (cv) of biomass}</span></span>
<span><span class="co">#'\item{value}{value of the variable}</span></span>
<span><span class="co">#'\item{units}{units of the variable}</span></span>
<span><span class="co">#'</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">create_sim_survey_index</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">atlmod</span>,<span class="va">fitstart</span><span class="op">=</span><span class="cn">NULL</span>,<span class="va">fitend</span><span class="op">=</span><span class="cn">NULL</span>,<span class="va">saveToData</span><span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># input is path to model config file for atlantisom</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="va">atlmod</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># path for survey and fishery config files</span></span>
<span>  <span class="va">cfgpath</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">atlmod</span>, <span class="st">".*config"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#works because atlantis directory named for model and simulation</span></span>
<span>  <span class="va">modpath</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split</a></span><span class="op">(</span><span class="va">d.name</span>, <span class="st">"/"</span>, simplify <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">modsim</span> <span class="op">&lt;-</span> <span class="va">modpath</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">modpath</span><span class="op">)</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co">#read in survey biomass data</span></span>
<span>  <span class="va">survObsBiom</span> <span class="op">&lt;-</span> <span class="fu">atlantisom</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/atlantisom/man/read_savedsurvs.html" class="external-link">read_savedsurvs</a></span><span class="op">(</span><span class="va">d.name</span>, <span class="st">'survB'</span><span class="op">)</span> <span class="co">#reads in all surveys</span></span>
<span>  </span>
<span>  <span class="co"># get config files for survey cv</span></span>
<span>  <span class="va">svcon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path<span class="op">=</span><span class="va">cfgpath</span>, pattern <span class="op">=</span> <span class="st">"*survey*"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># read true list with run and biol pars, etc</span></span>
<span>  <span class="va">omlist_ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">d.name</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">scenario.name</span>, <span class="st">"omlist_ss.rds"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># model timesteps, etc from omdimensions script</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">cfgpath</span>,<span class="st">"/omdimensions.R"</span><span class="op">)</span>, local <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#Number of years</span></span>
<span>  <span class="va">nyears</span> <span class="op">&lt;-</span> <span class="va">omlist_ss</span><span class="op">$</span><span class="va">runpar</span><span class="op">$</span><span class="va">nyears</span></span>
<span>  <span class="va">total_sample</span> <span class="op">&lt;-</span> <span class="va">omlist_ss</span><span class="op">$</span><span class="va">runpar</span><span class="op">$</span><span class="va">tstop</span><span class="op">/</span><span class="va">omlist_ss</span><span class="op">$</span><span class="va">runpar</span><span class="op">$</span><span class="va">outputstep</span></span>
<span>  </span>
<span>  <span class="co"># user specified fit start and times if different from full run</span></span>
<span>  <span class="va">fitstartyr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">fitstart</span><span class="op">)</span>, <span class="va">fitstart</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">fitendyr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">fitend</span><span class="op">)</span>, <span class="va">fitend</span>, <span class="va">total_sample</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">atlantis_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">total_sample</span><span class="op">)</span>  </span>
<span>  <span class="va">mod_burnin</span> <span class="op">&lt;-</span> <span class="va">fitstartyr</span><span class="op">*</span><span class="va">stepperyr</span><span class="op">+</span><span class="fl">1</span></span>
<span>  <span class="va">fit_nyears</span> <span class="op">&lt;-</span> <span class="va">fitendyr</span><span class="op">-</span><span class="va">fitstartyr</span></span>
<span>  <span class="va">fit_ntimes</span> <span class="op">&lt;-</span> <span class="va">fit_nyears</span><span class="op">*</span><span class="va">stepperyr</span></span>
<span>  <span class="va">fittimes</span> <span class="op">&lt;-</span> <span class="va">atlantis_full</span><span class="op">[</span><span class="va">mod_burnin</span><span class="op">:</span><span class="op">(</span><span class="va">mod_burnin</span><span class="op">+</span><span class="va">fit_ntimes</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="co">#fit_timesteps &lt;- seq(fittimes[stepperyr], max(fittimes), by=stepperyr) #last timestep</span></span>
<span>  <span class="co">#fit_years &lt;- unique(floor(fittimes/stepperyr)) #from Christine's new sardine_config.R</span></span>
<span>  <span class="co">#fittimes.days &lt;- if(omlist_ss$runpar$outputstepunit=="days") fittimes*omlist_ss$runpar$outputstep</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># survey cv lookup from config files</span></span>
<span>  <span class="va">svcvlook</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">c</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">svcon</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="va">svcon</span><span class="op">[</span><span class="va">c</span><span class="op">]</span>, local <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">surv_cv_n</span> <span class="op">&lt;-</span> <span class="va">surv_cv</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>survey<span class="op">=</span><span class="va">survey.name</span><span class="op">)</span></span>
<span>    <span class="va">svcvlook</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">svcvlook</span>, <span class="va">surv_cv_n</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">allsvbio</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#multiple surveys named in list object</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">s</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">survObsBiom</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co">#arrange into wide format: year, Species1, Species2 ... and write csv</span></span>
<span>    <span class="va">svbio</span> <span class="op">&lt;-</span> <span class="va">survObsBiom</span><span class="op">[[</span><span class="va">s</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">time</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">fittimes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">time</span><span class="op">/</span><span class="va">stepperyr</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">year</span>, <span class="va">atoutput</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>biomass <span class="op">=</span> <span class="va">atoutput</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">omlist_ss</span><span class="op">$</span><span class="va">funct.group_ss</span>, <span class="va">Code</span>, <span class="va">Name</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span> <span class="op">=</span> <span class="st">"Name"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ModSim <span class="op">=</span> <span class="va">modsim</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>survey <span class="op">=</span> <span class="va">s</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">svcvlook</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ModSim</span>, <span class="va">year</span>, <span class="va">Code</span>, Name<span class="op">=</span><span class="va">species</span>, <span class="va">survey</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"biomass"</span>, <span class="st">"cv"</span><span class="op">)</span>, </span>
<span>                          names_to <span class="op">=</span> <span class="st">"variable"</span>,</span>
<span>                          values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">variable</span><span class="op">==</span><span class="st">"biomass"</span>, <span class="st">"tons"</span>, <span class="st">"unitless"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">Name</span>, <span class="va">survey</span>, <span class="va">variable</span>, <span class="va">year</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">allsvbio</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">allsvbio</span>, <span class="va">svbio</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">simSurveyIndex</span> <span class="op">&lt;-</span> <span class="va">allsvbio</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">saveToData</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co">#saveRDS(focalSpecies,saveToRDS)</span></span>
<span>    <span class="fu">usethis</span><span class="fu">::</span><span class="fu">use_data</span><span class="op">(</span><span class="va">simSurveyIndex</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">simSurveyIndex</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>All functions are in this mskeyrun repository folder: <a href="https://github.com/NOAA-EDAB/ms-keyrun/tree/master/data-raw/R" class="external-link uri">https://github.com/NOAA-EDAB/ms-keyrun/tree/master/data-raw/R</a></p>
</div>
<div class="section level3">
<h3 id="visualize-simulated-data">Visualize simulated data<a class="anchor" aria-label="anchor" href="#visualize-simulated-data"></a>
</h3>
<div class="section level4">
<h4 id="plotting-functions">Plotting functions<a class="anchor" aria-label="anchor" href="#plotting-functions"></a>
</h4>
<p>A collection of functions used previously that may be harvested and
modified for diagnostics or visualizations in the ms-keyrun and ICES
WGSAM skill assessment projects.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot biomass time series facet wrapped by species</span></span>
<span><span class="va">plotB</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dat</span>, <span class="va">truedat</span><span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>    <span class="va">svbio</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable</span><span class="op">==</span><span class="st">"biomass"</span><span class="op">)</span></span>
<span>    <span class="va">svcv</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable</span><span class="op">==</span><span class="st">"cv"</span><span class="op">)</span></span>
<span>  </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">svbio</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">year</span>,y<span class="op">=</span><span class="va">value</span>, color<span class="op">=</span><span class="st">"Survey Biomass"</span><span class="op">)</span>, </span>
<span>              alpha <span class="op">=</span> <span class="fl">10</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="op">{</span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">truedat</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">truedat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span><span class="op">/</span><span class="fl">365</span>,y<span class="op">=</span><span class="va">atoutput</span>, color<span class="op">=</span><span class="st">"True B"</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">3</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span><span class="op">}</span> <span class="op">+</span> </span>
<span>    <span class="fu">theme_tufte</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"model year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"tons"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>colour<span class="op">=</span><span class="va">dat</span><span class="op">$</span><span class="va">ModSim</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Name</span>, scales<span class="op">=</span><span class="st">"free"</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># make a catch series function that can be split by fleet? this doesnt</span></span>
<span><span class="co"># also note different time (days) from model timestep in all other output</span></span>
<span><span class="va">plotC</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dat</span>, <span class="va">truedat</span><span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>    <span class="va">ctbio</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable</span><span class="op">==</span><span class="st">"catch"</span><span class="op">)</span></span>
<span>    <span class="va">ctcv</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable</span><span class="op">==</span><span class="st">"cv"</span><span class="op">)</span></span>
<span>  </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">ctbio</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">year</span>,y<span class="op">=</span><span class="va">value</span>, color<span class="op">=</span><span class="st">"Catch biomass"</span><span class="op">)</span>, </span>
<span>              alpha <span class="op">=</span> <span class="fl">10</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="op">{</span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">truedat</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">truedat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span><span class="op">/</span><span class="fl">365</span>,y<span class="op">=</span><span class="va">atoutput</span>, color<span class="op">=</span><span class="st">"True Catch"</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">3</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span><span class="op">}</span> <span class="op">+</span> </span>
<span>    <span class="fu">theme_tufte</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"model year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"tons"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>colour<span class="op">=</span><span class="va">dat</span><span class="op">$</span><span class="va">ModSim</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Name</span>, scales<span class="op">=</span><span class="st">"free"</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># note on ggplot default colors, can get the first and second using this</span></span>
<span><span class="co"># library(scales)</span></span>
<span><span class="co"># show_col(hue_pal()(2))</span></span>
<span></span>
<span><span class="co"># plot length frequencies by timestep (one species)</span></span>
<span><span class="va">plotlen</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dat</span>, <span class="va">effN</span><span class="op">=</span><span class="fl">1</span>, <span class="va">truedat</span><span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Census Lcomp"</span><span class="op">=</span><span class="st">"#00BFC4"</span>,<span class="st">"Sample Lcomp"</span><span class="op">=</span><span class="st">"#F8766D"</span><span class="op">)</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">lenbin</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="op">{</span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">truedat</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="va">value</span><span class="op">/</span><span class="va">effN</span><span class="op">)</span><span class="op">)</span><span class="op">}</span> <span class="op">+</span></span>
<span>    <span class="op">{</span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">truedat</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="va">censuslen</span><span class="op">/</span><span class="va">totlen</span>, fill<span class="op">=</span><span class="st">"Census Lcomp"</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">5</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span><span class="op">}</span> <span class="op">+</span></span>
<span>    <span class="op">{</span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">truedat</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="va">atoutput</span><span class="op">/</span><span class="va">effN</span>, fill<span class="op">=</span><span class="st">"Sample Lcomp"</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">5</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span><span class="op">}</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_tufte</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"length (cm)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="op">{</span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">truedat</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"number"</span><span class="op">)</span><span class="op">}</span> <span class="op">+</span></span>
<span>    <span class="op">{</span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">truedat</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"proportion"</span><span class="op">)</span><span class="op">}</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">""</span>, values<span class="op">=</span><span class="va">cols</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">ModSim</span>,</span>
<span>                          <span class="va">dat</span><span class="op">$</span><span class="va">Name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">year</span>, ncol<span class="op">=</span><span class="fl">6</span>, scales<span class="op">=</span><span class="st">"free_y"</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># plot numbers at age by timestep (one species)</span></span>
<span><span class="va">Natageplot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dat</span>, <span class="va">effN</span><span class="op">=</span><span class="fl">1</span>, <span class="va">truedat</span><span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">age</span>, y<span class="op">=</span><span class="va">value</span><span class="op">/</span><span class="va">effN</span>, color<span class="op">=</span><span class="st">"Est Comp"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="op">{</span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">truedat</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">agecl</span>, y<span class="op">=</span><span class="va">numAtAge</span><span class="op">/</span><span class="va">totN</span>, color<span class="op">=</span><span class="st">"True Comp"</span><span class="op">)</span><span class="op">)</span><span class="op">}</span> <span class="op">+</span> </span>
<span>    <span class="fu">theme_tufte</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span>    </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"age"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="op">{</span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">truedat</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"number"</span><span class="op">)</span><span class="op">}</span> <span class="op">+</span></span>
<span>    <span class="op">{</span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">truedat</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"proportion"</span><span class="op">)</span><span class="op">}</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">ModSim</span>,</span>
<span>                          <span class="va">dat</span><span class="op">$</span><span class="va">Name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">year</span>, ncol<span class="op">=</span><span class="fl">6</span>, scales<span class="op">=</span><span class="st">"free_y"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># plot weight at age time series facet wrapped by species</span></span>
<span><span class="va">wageplot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dat</span>, <span class="va">truedat</span><span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_tufte</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"model year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"average individual weight (g)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">ModSim</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Name"</span><span class="op">)</span>, scales<span class="op">=</span><span class="st">"free_y"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="read-in-the-data-to-check-with-plots">Read in the “data” to check with plots<a class="anchor" aria-label="anchor" href="#read-in-the-data-to-check-with-plots"></a>
</h4>
<p>The <code>mskeyrun</code> simulated data objects are all
dataframes.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">survObsBiom</span> <span class="op">&lt;-</span> <span class="fu">mskeyrun</span><span class="fu">::</span><span class="va"><a href="../reference/simSurveyIndex.html">simSurveyIndex</a></span> <span class="co">#atlantisom::read_savedsurvs(d.name, 'survB')</span></span>
<span><span class="co">#age_comp_data &lt;- mskeyrun::simSurveyAgeLencomp #atlantisom::read_savedsurvs(d.name, 'survAge') #not using in assessment</span></span>
<span><span class="va">len_comp_data</span> <span class="op">&lt;-</span> <span class="fu">mskeyrun</span><span class="fu">::</span><span class="va"><a href="../reference/simSurveyLencomp.html">simSurveyLencomp</a></span> <span class="co">#atlantisom::read_savedsurvs(d.name, 'survLen')</span></span>
<span><span class="co">#wtage &lt;- atlantisom::read_savedsurvs(d.name, 'survWtage')  #not using in assessment</span></span>
<span><span class="va">annage_comp_data</span> <span class="op">&lt;-</span> <span class="fu">mskeyrun</span><span class="fu">::</span><span class="va"><a href="../reference/simSurveyAgecomp.html">simSurveyAgecomp</a></span> <span class="co">#atlantisom::read_savedsurvs(d.name, 'survAnnAge')</span></span>
<span><span class="va">annage_wtage</span> <span class="op">&lt;-</span> <span class="fu">mskeyrun</span><span class="fu">::</span><span class="va"><a href="../reference/simSurveyWtatAge.html">simSurveyWtatAge</a></span> <span class="co">#atlantisom::read_savedsurvs(d.name, 'survAnnWtage')</span></span>
<span></span>
<span><span class="co">#all_diets &lt;- atlantisom::read_savedsurvs(d.name, 'survDiet') #not using in assessment</span></span>
<span></span>
<span><span class="va">catchbio_ss</span> <span class="op">&lt;-</span> <span class="fu">mskeyrun</span><span class="fu">::</span><span class="va"><a href="../reference/simCatchIndex.html">simCatchIndex</a></span> <span class="co">#atlantisom::read_savedfisheries(d.name, 'Catch')</span></span>
<span><span class="va">catchlen_ss</span> <span class="op">&lt;-</span> <span class="fu">mskeyrun</span><span class="fu">::</span><span class="va"><a href="../reference/simFisheryLencomp.html">simFisheryLencomp</a></span> <span class="co">#atlantisom::read_savedfisheries(d.name, "catchLen")</span></span>
<span><span class="co">#fish_age_comp &lt;- #atlantisom::read_savedfisheries(d.name, "catchAge")</span></span>
<span><span class="va">fish_annage_comp</span> <span class="op">&lt;-</span> <span class="fu">mskeyrun</span><span class="fu">::</span><span class="va"><a href="../reference/simFisheryAgecomp.html">simFisheryAgecomp</a></span> <span class="co">#atlantisom::read_savedfisheries(d.name, 'catchAnnAge')</span></span>
<span><span class="va">fish_annage_wtage</span> <span class="op">&lt;-</span> <span class="fu">mskeyrun</span><span class="fu">::</span><span class="va"><a href="../reference/simFisheryWtatAge.html">simFisheryWtatAge</a></span> <span class="co">#atlantisom::read_savedfisheries(d.name, 'catchAnnWtage')</span></span></code></pre></div>
</div>
</div>
<div class="section level3 tabset">
<h3 class="tabset" id="visualize-survey-outputs">Visualize survey outputs<a class="anchor" aria-label="anchor" href="#visualize-survey-outputs"></a>
</h3>
<p>These plots represent the full <code>mskeyrun</code> simulated time
series for the survey biomass index and weight at age, and a subset for
length and age composition.</p>




<ul class="nav nav-tabs" id="visualize-survey-outputs" role="tablist">
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#survey-biomass-index" id="survey-biomass-index-tab" type="button" role="tab" aria-controls="survey-biomass-index" aria-selected="true" class="active nav-link">Survey biomass index</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#survey-length-composition" id="survey-length-composition-tab" type="button" role="tab" aria-controls="survey-length-composition" aria-selected="false" class="nav-link">Survey length composition</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#survey-age-composition-annual-ages" id="survey-age-composition-annual-ages-tab" type="button" role="tab" aria-controls="survey-age-composition-annual-ages" aria-selected="false" class="nav-link">Survey age composition (annual ages)</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#survey-iterpolated-weight-at-age-annual-ages" id="survey-iterpolated-weight-at-age-annual-ages-tab" type="button" role="tab" aria-controls="survey-iterpolated-weight-at-age-annual-ages" aria-selected="false" class="nav-link">Survey iterpolated weight at age (annual ages)</button></li>
</ul>
<div class="tab-content">
<div class="active  tab-pane" id="survey-biomass-index" role="tabpanel" aria-labelledby="survey-biomass-index-tab">

<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compare with true output (all timesteps)</span></span>
<span><span class="co"># for(s in names(survObsBiom)){</span></span>
<span><span class="co">#   cat("  \n##### ",  s,"  \n")</span></span>
<span><span class="co">#   print(plotB(survObsBiom[[s]][[1]], omlist_ss$truetotbio_ss))</span></span>
<span><span class="co">#   cat("  \n")</span></span>
<span><span class="co"># }</span></span>
<span></span>
<span><span class="co"># plots survey only</span></span>
<span> <span class="kw">for</span><span class="op">(</span><span class="va">s</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">survObsBiom</span><span class="op">$</span><span class="va">survey</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n##### "</span>,  <span class="va">s</span>,<span class="st">"  \n"</span><span class="op">)</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">plotB</span><span class="op">(</span><span class="va">survObsBiom</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">(</span><span class="va">survey</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">s</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span> <span class="op">}</span></span></code></pre></div>
<div class="section level5">
<h5 id="bts_fall_allbox_effic1">BTS_fall_allbox_effic1<a class="anchor" aria-label="anchor" href="#bts_fall_allbox_effic1"></a>
</h5>
<p><img src="SimData_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div class="section level5">
<h5 id="bts_spring_allbox_effic1">BTS_spring_allbox_effic1<a class="anchor" aria-label="anchor" href="#bts_spring_allbox_effic1"></a>
</h5>
<p><img src="SimData_files/figure-html/unnamed-chunk-10-2.png" width="700"></p>
</div>
</div>
<div class="tab-pane" id="survey-length-composition" role="tabpanel" aria-labelledby="survey-length-composition-tab">

<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># not the full time series, just 24 yrs after catches start in year 55</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">s</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">len_comp_data</span><span class="op">$</span><span class="va">survey</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n##### "</span>,  <span class="va">s</span>,<span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="va">lcompsub</span> <span class="op">&lt;-</span> <span class="va">len_comp_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">survey</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">s</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">55</span><span class="op">:</span><span class="fl">78</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">Name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">group_map</span><span class="op">(</span><span class="op">~</span> <span class="fu">plotlen</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span>, keep <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lcompsub</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">lcompsub</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level5">
<h5 id="bts_fall_allbox_effic1-1">BTS_fall_allbox_effic1<a class="anchor" aria-label="anchor" href="#bts_fall_allbox_effic1-1"></a>
</h5>
<p><img src="SimData_files/figure-html/lencomp-1-1.png" width="700"><img src="SimData_files/figure-html/lencomp-1-2.png" width="700"><img src="SimData_files/figure-html/lencomp-1-3.png" width="700"><img src="SimData_files/figure-html/lencomp-1-4.png" width="700"><img src="SimData_files/figure-html/lencomp-1-5.png" width="700"><img src="SimData_files/figure-html/lencomp-1-6.png" width="700"><img src="SimData_files/figure-html/lencomp-1-7.png" width="700"><img src="SimData_files/figure-html/lencomp-1-8.png" width="700"><img src="SimData_files/figure-html/lencomp-1-9.png" width="700"><img src="SimData_files/figure-html/lencomp-1-10.png" width="700"><img src="SimData_files/figure-html/lencomp-1-11.png" width="700"></p>
</div>
<div class="section level5">
<h5 id="bts_spring_allbox_effic1-1">BTS_spring_allbox_effic1<a class="anchor" aria-label="anchor" href="#bts_spring_allbox_effic1-1"></a>
</h5>
<p><img src="SimData_files/figure-html/lencomp-1-12.png" width="700"><img src="SimData_files/figure-html/lencomp-1-13.png" width="700"><img src="SimData_files/figure-html/lencomp-1-14.png" width="700"><img src="SimData_files/figure-html/lencomp-1-15.png" width="700"><img src="SimData_files/figure-html/lencomp-1-16.png" width="700"><img src="SimData_files/figure-html/lencomp-1-17.png" width="700"><img src="SimData_files/figure-html/lencomp-1-18.png" width="700"><img src="SimData_files/figure-html/lencomp-1-19.png" width="700"><img src="SimData_files/figure-html/lencomp-1-20.png" width="700"><img src="SimData_files/figure-html/lencomp-1-21.png" width="700"></p>
</div>
</div>
<div class="tab-pane" id="survey-age-composition-annual-ages" role="tabpanel" aria-labelledby="survey-age-composition-annual-ages-tab">

<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span><span class="op">(</span><span class="va">s</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">annage_comp_data</span><span class="op">$</span><span class="va">survey</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n##### "</span>,  <span class="va">s</span>,<span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="va">acompsub</span> <span class="op">&lt;-</span> <span class="va">annage_comp_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">survey</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">s</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">55</span><span class="op">:</span><span class="fl">78</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">Name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="co">#left_join(., trueNage) %&gt;%</span></span>
<span>    <span class="fu">group_map</span><span class="op">(</span><span class="op">~</span> <span class="fu">Natageplot</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span>, keep <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># plots only sampled age comp</span></span>
<span>    <span class="co">#group_map(~ Natageplot(.x, effN = 100000, truedat = 1), keep = TRUE) # plots merged true age comp</span></span>
<span>  </span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">acompsub</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">acompsub</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level5">
<h5 id="bts_fall_allbox_effic1-2">BTS_fall_allbox_effic1<a class="anchor" aria-label="anchor" href="#bts_fall_allbox_effic1-2"></a>
</h5>
<p><img src="SimData_files/figure-html/plot-annagecomp-1.png" width="700"><img src="SimData_files/figure-html/plot-annagecomp-2.png" width="700"><img src="SimData_files/figure-html/plot-annagecomp-3.png" width="700"><img src="SimData_files/figure-html/plot-annagecomp-4.png" width="700"><img src="SimData_files/figure-html/plot-annagecomp-5.png" width="700"><img src="SimData_files/figure-html/plot-annagecomp-6.png" width="700"><img src="SimData_files/figure-html/plot-annagecomp-7.png" width="700"><img src="SimData_files/figure-html/plot-annagecomp-8.png" width="700"><img src="SimData_files/figure-html/plot-annagecomp-9.png" width="700"><img src="SimData_files/figure-html/plot-annagecomp-10.png" width="700"><img src="SimData_files/figure-html/plot-annagecomp-11.png" width="700"></p>
</div>
<div class="section level5">
<h5 id="bts_spring_allbox_effic1-2">BTS_spring_allbox_effic1<a class="anchor" aria-label="anchor" href="#bts_spring_allbox_effic1-2"></a>
</h5>
<p><img src="SimData_files/figure-html/plot-annagecomp-12.png" width="700"><img src="SimData_files/figure-html/plot-annagecomp-13.png" width="700"><img src="SimData_files/figure-html/plot-annagecomp-14.png" width="700"><img src="SimData_files/figure-html/plot-annagecomp-15.png" width="700"><img src="SimData_files/figure-html/plot-annagecomp-16.png" width="700"><img src="SimData_files/figure-html/plot-annagecomp-17.png" width="700"><img src="SimData_files/figure-html/plot-annagecomp-18.png" width="700"><img src="SimData_files/figure-html/plot-annagecomp-19.png" width="700"><img src="SimData_files/figure-html/plot-annagecomp-20.png" width="700"><img src="SimData_files/figure-html/plot-annagecomp-21.png" width="700"><img src="SimData_files/figure-html/plot-annagecomp-22.png" width="700"></p>
</div>
</div>
<div class="tab-pane" id="survey-iterpolated-weight-at-age-annual-ages" role="tabpanel" aria-labelledby="survey-iterpolated-weight-at-age-annual-ages-tab">

<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span><span class="op">(</span><span class="va">s</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">annage_wtage</span><span class="op">$</span><span class="va">survey</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n##### "</span>,  <span class="va">s</span>,<span class="st">"  \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">wageplot</span><span class="op">(</span><span class="va">annage_wtage</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">(</span><span class="va">survey</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">s</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level5">
<h5 id="bts_fall_allbox_effic1-3">BTS_fall_allbox_effic1<a class="anchor" aria-label="anchor" href="#bts_fall_allbox_effic1-3"></a>
</h5>
<p><img src="SimData_files/figure-html/plot-annwtage-1.png" width="700"></p>
</div>
<div class="section level5">
<h5 id="bts_spring_allbox_effic1-3">BTS_spring_allbox_effic1<a class="anchor" aria-label="anchor" href="#bts_spring_allbox_effic1-3"></a>
</h5>
<p><img src="SimData_files/figure-html/plot-annwtage-2.png" width="700"></p>
</div>
</div>
</div>
</div>
<div class="section level3 unnumbered">
<h3 class="unnumbered" id="section"></h3>
</div>
<div class="section level3 tabset">
<h3 class="tabset" id="visualize-fishery-data">Visualize fishery data<a class="anchor" aria-label="anchor" href="#visualize-fishery-data"></a>
</h3>
<p>These plots represent the the full <code>mskeyrun</code> simulated
time series for fishery catch and weight at age, and a subset for length
and age composition.</p>




<ul class="nav nav-tabs" id="visualize-fishery-data" role="tablist">
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#fishery-catch-time-series" id="fishery-catch-time-series-tab" type="button" role="tab" aria-controls="fishery-catch-time-series" aria-selected="true" class="active nav-link">Fishery catch time series</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#fishery-length-composition" id="fishery-length-composition-tab" type="button" role="tab" aria-controls="fishery-length-composition" aria-selected="false" class="nav-link">Fishery length composition</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#fishery-catch-at-age-annual-ages" id="fishery-catch-at-age-annual-ages-tab" type="button" role="tab" aria-controls="fishery-catch-at-age-annual-ages" aria-selected="false" class="nav-link">Fishery catch at age (annual ages)</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#fishery-interpolated-weight-at-age-annual-ages" id="fishery-interpolated-weight-at-age-annual-ages-tab" type="button" role="tab" aria-controls="fishery-interpolated-weight-at-age-annual-ages" aria-selected="false" class="nav-link">Fishery interpolated weight at age (annual ages)</button></li>
</ul>
<div class="tab-content">
<div class="active  tab-pane" id="fishery-catch-time-series" role="tabpanel" aria-labelledby="fishery-catch-time-series-tab">

<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># observed catch only</span></span>
<span><span class="fu">plotC</span><span class="op">(</span><span class="va">catchbio_ss</span><span class="op">)</span></span></code></pre></div>
<p><img src="SimData_files/figure-html/catchind-1-1.png" width="700"></p>
</div>
<div class="tab-pane" id="fishery-length-composition" role="tabpanel" aria-labelledby="fishery-length-composition-tab">

<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lcompsub</span> <span class="op">&lt;-</span> <span class="va">catchlen_ss</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">55</span><span class="op">:</span><span class="fl">78</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">Name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">group_map</span><span class="op">(</span><span class="op">~</span> <span class="fu">plotlen</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span>, keep <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lcompsub</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">lcompsub</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="SimData_files/figure-html/unnamed-chunk-11-1.png" width="700"><img src="SimData_files/figure-html/unnamed-chunk-11-2.png" width="700"><img src="SimData_files/figure-html/unnamed-chunk-11-3.png" width="700"><img src="SimData_files/figure-html/unnamed-chunk-11-4.png" width="700"><img src="SimData_files/figure-html/unnamed-chunk-11-5.png" width="700"><img src="SimData_files/figure-html/unnamed-chunk-11-6.png" width="700"><img src="SimData_files/figure-html/unnamed-chunk-11-7.png" width="700"><img src="SimData_files/figure-html/unnamed-chunk-11-8.png" width="700"><img src="SimData_files/figure-html/unnamed-chunk-11-9.png" width="700"></p>
</div>
<div class="tab-pane" id="fishery-catch-at-age-annual-ages" role="tabpanel" aria-labelledby="fishery-catch-at-age-annual-ages-tab">

<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">acompsub</span> <span class="op">&lt;-</span> <span class="va">fish_annage_comp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">55</span><span class="op">:</span><span class="fl">78</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">Name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co">#left_join(., trueCAA) %&gt;%</span></span>
<span>  <span class="fu">group_map</span><span class="op">(</span><span class="op">~</span> <span class="fu">Natageplot</span><span class="op">(</span><span class="va">.x</span><span class="op">)</span>, keep <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># plots only sampled age comp</span></span>
<span>  <span class="co">#group_map(~ Natageplot(.x, effN = 200, truedat = 1), keep = TRUE) # plots merged true age comp</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">acompsub</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">acompsub</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="SimData_files/figure-html/plot-catchagecomp-1.png" width="700"><img src="SimData_files/figure-html/plot-catchagecomp-2.png" width="700"><img src="SimData_files/figure-html/plot-catchagecomp-3.png" width="700"><img src="SimData_files/figure-html/plot-catchagecomp-4.png" width="700"><img src="SimData_files/figure-html/plot-catchagecomp-5.png" width="700"><img src="SimData_files/figure-html/plot-catchagecomp-6.png" width="700"><img src="SimData_files/figure-html/plot-catchagecomp-7.png" width="700"><img src="SimData_files/figure-html/plot-catchagecomp-8.png" width="700"><img src="SimData_files/figure-html/plot-catchagecomp-9.png" width="700"></p>
</div>
<div class="tab-pane" id="fishery-interpolated-weight-at-age-annual-ages" role="tabpanel" aria-labelledby="fishery-interpolated-weight-at-age-annual-ages-tab">

<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">wageplot</span><span class="op">(</span><span class="va">fish_annage_wtage</span><span class="op">)</span></span></code></pre></div>
<p><img src="SimData_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
</div>
</div>
<div class="section level3 unnumbered">
<h3 class="unnumbered" id="section-1"></h3>
</div>
<div class="section level3">
<h3 id="write-to-model-input-files">Write to model input files<a class="anchor" aria-label="anchor" href="#write-to-model-input-files"></a>
</h3>
<p>Our goal was to have a reproducible process for all aspects of data
generation through model inputs. The simulated data is included in the
<code>mskeyrun</code> data package, data inputs are derived from those
sources.</p>
<div class="section level4">
<h4 id="multispecies-surplus-production-model-msspm">Multispecies surplus production model (MSSPM)<a class="anchor" aria-label="anchor" href="#multispecies-surplus-production-model-msspm"></a>
</h4>
<p>[<em>To be added</em>]</p>
</div>
<div class="section level4">
<h4 id="length-structured-multispecies-model-hydra">Length-structured multispecies model (Hydra)<a class="anchor" aria-label="anchor" href="#length-structured-multispecies-model-hydra"></a>
</h4>
<p>Hydra input files were developed directly from <code>mskeyrun</code>
datasets by modifying functions in the <a href="https://github.com/thefaylab/hydradata" class="external-link"><code>hydradata</code> R
package</a>. The function <code>create_Rdata_mskeyrun.R</code> (<a href="https://github.com/thefaylab/hydradata/blob/master/data-raw/create_RData_mskeyrun.R" class="external-link">code</a>)
allows the user to specify whether datasets should be constructed from
Atlantis-simulated or real Georges Bank data, and the number of length
bins to use for composition data, then creates an R data object. This
data object is then used to create data and parameter input files using
the function <code><a href="https://rdrr.io/pkg/hydradata/man/create_datpin_files.html" class="external-link">hydradata::create_datpin_files()</a></code>.</p>
<p>For example, this process creates the simulated dataset with 5 length
bins:</p>
<p>The <code>create_RData_mskeyrun.R</code> file was sourced, and
<code>create_RData_mskeyrun("sim", nlenbin = 5)</code> was run to make a
new <code>hydraDataList_msk.rda</code> file in the package. Then the
package is built locally, R is restarted, and the following code block
is run to produce input files.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">hydradata</span><span class="op">)</span></span>
<span><span class="va">inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/hydradata/man/setup_default_inputs.html" class="external-link">setup_default_inputs</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">inputs</span><span class="op">$</span><span class="va">outDir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">inputs</span><span class="op">$</span><span class="va">outputFilename</span> <span class="op">&lt;-</span> <span class="st">"hydra_sim_NOBA_5bin_0comp"</span> </span>
<span></span>
<span><span class="co"># tpl code removes 0 so replace in data</span></span>
<span><span class="va">nbins</span> <span class="op">&lt;-</span> <span class="va">hydraDataList_msk</span><span class="op">$</span><span class="va">Nsizebins</span></span>
<span><span class="va">hydraDataList_msk</span><span class="op">$</span><span class="va">observedCatchSize</span><span class="op">[</span>,<span class="fl">7</span><span class="op">:</span><span class="op">(</span><span class="fl">6</span><span class="op">+</span><span class="va">nbins</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="va">hydraDataList_msk</span><span class="op">$</span><span class="va">observedCatchSize</span><span class="op">[</span>,<span class="fl">7</span><span class="op">:</span><span class="op">(</span><span class="fl">6</span><span class="op">+</span><span class="va">nbins</span><span class="op">)</span><span class="op">]</span><span class="op">==</span><span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1e-4</span></span>
<span><span class="va">hydraDataList_msk</span><span class="op">$</span><span class="va">observedSurvSize</span><span class="op">[</span>,<span class="fl">6</span><span class="op">:</span><span class="op">(</span><span class="fl">5</span><span class="op">+</span><span class="va">nbins</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="va">hydraDataList_msk</span><span class="op">$</span><span class="va">observedSurvSize</span><span class="op">[</span>,<span class="fl">6</span><span class="op">:</span><span class="op">(</span><span class="fl">5</span><span class="op">+</span><span class="va">nbins</span><span class="op">)</span><span class="op">]</span><span class="op">==</span><span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1e-4</span></span>
<span></span>
<span><span class="va">hydraDataList_5bin_0comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/hydradata/man/create_datpin_files.html" class="external-link">create_datpin_files</a></span><span class="op">(</span><span class="va">inputs</span>,<span class="va">hydraDataList_msk</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># this saves the specific hydralist object, so we could saveRDS it to a diagnostics folder?</span></span>
<span><span class="co"># advantage of rds format is we can assign it when reading it in to diagnostics scripts</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">hydraDataList_5bin_0comp</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"inputRdatalists/hydraDataList_5bin_0comp.rds"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Run <code>create_RData_mskeyrun("sim", nlenbin = 10)</code> in
<code>hydradata</code>, rebuild package, restart R, then…</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">hydradata</span><span class="op">)</span></span>
<span><span class="va">inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/hydradata/man/setup_default_inputs.html" class="external-link">setup_default_inputs</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">inputs</span><span class="op">$</span><span class="va">outDir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">inputs</span><span class="op">$</span><span class="va">outputFilename</span> <span class="op">&lt;-</span> <span class="st">"hydra_sim_NOBA_10bin_0comp"</span> </span>
<span></span>
<span><span class="co"># tpl code removes 0 so replace in data</span></span>
<span><span class="va">nbins</span> <span class="op">&lt;-</span> <span class="va">hydraDataList_msk</span><span class="op">$</span><span class="va">Nsizebins</span></span>
<span><span class="va">hydraDataList_msk</span><span class="op">$</span><span class="va">observedCatchSize</span><span class="op">[</span>,<span class="fl">7</span><span class="op">:</span><span class="op">(</span><span class="fl">6</span><span class="op">+</span><span class="va">nbins</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="va">hydraDataList_msk</span><span class="op">$</span><span class="va">observedCatchSize</span><span class="op">[</span>,<span class="fl">7</span><span class="op">:</span><span class="op">(</span><span class="fl">6</span><span class="op">+</span><span class="va">nbins</span><span class="op">)</span><span class="op">]</span><span class="op">==</span><span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1e-4</span></span>
<span><span class="va">hydraDataList_msk</span><span class="op">$</span><span class="va">observedSurvSize</span><span class="op">[</span>,<span class="fl">6</span><span class="op">:</span><span class="op">(</span><span class="fl">5</span><span class="op">+</span><span class="va">nbins</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="va">hydraDataList_msk</span><span class="op">$</span><span class="va">observedSurvSize</span><span class="op">[</span>,<span class="fl">6</span><span class="op">:</span><span class="op">(</span><span class="fl">5</span><span class="op">+</span><span class="va">nbins</span><span class="op">)</span><span class="op">]</span><span class="op">==</span><span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1e-4</span></span>
<span></span>
<span></span>
<span><span class="va">hydraDataList_10bin_0comp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/hydradata/man/create_datpin_files.html" class="external-link">create_datpin_files</a></span><span class="op">(</span><span class="va">inputs</span>,<span class="va">hydraDataList_msk</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># this saves the specific hydralist object, so we could saveRDS it to a diagnostics folder?</span></span>
<span><span class="co"># advantage of rds format is we can assign it when reading it in to diagnostics scripts</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">hydraDataList_10bin_0comp</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"inputRdatalists/hydraDataList_10bin_0comp.rds"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="age-structured-multispecies-statistical-catch-at-age-model-msscaa">Age structured multispecies statistical catch at age model
(MSSCAA)<a class="anchor" aria-label="anchor" href="#age-structured-multispecies-statistical-catch-at-age-model-msscaa"></a>
</h4>
<p>Work in progress <a href="https://github.com/thefaylab/MS-SCAA/blob/master/simulated-data/Atlantis2MSCAA.Rmd" class="external-link">here</a>
but not finished for October 2022 review.</p>
</div>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-audzijonyte_atlantis_2019" class="csl-entry">
Audzijonyte, A., Pethybridge, H., Porobic, J., Gorton, R., Kaplan, I.,
&amp; Fulton, E. A. (2019). Atlantis: <span>A</span> spatially explicit
end-to-end marine ecosystem model with dynamically integrated physics,
ecology and socio-economic modules. <em>Methods in Ecology and
Evolution</em>, <em>10</em>(10), 1814–1819. <a href="https://doi.org/10.1111/2041-210X.13272" class="external-link">https://doi.org/10.1111/2041-210X.13272</a><div class="csl-block">_eprint:
https://besjournals.onlinelibrary.wiley.com/doi/pdf/10.1111/2041-210X.13272</div>
</div>
<div id="ref-hansen_sensitivity_2019" class="csl-entry">
Hansen, C., Drinkwater, K. F., Jähkel, A., Fulton, E. A., Gorton, R.,
&amp; Skern-Mauritzen, M. (2019). Sensitivity of the
<span>Norwegian</span> and <span>Barents</span> <span>Sea</span>
<span>Atlantis</span> end-to-end ecosystem model to parameter
perturbations of key species. <em>PLOS ONE</em>, <em>14</em>(2),
e0210419. <a href="https://doi.org/10.1371/journal.pone.0210419" class="external-link">https://doi.org/10.1371/journal.pone.0210419</a>
</div>
<div id="ref-hansen_set-up_2016" class="csl-entry">
Hansen, C., Skern-Mauritzen, M., Meeren, G. van der, Jähkel, A., &amp;
Drinkwater, K. F. (2016). <em>Set-up of the <span>Nordic</span> and
<span>Barents</span> <span>Seas</span> (<span>NoBa</span>)
<span>Atlantis</span> model</em>. Havforskningsinstituttet. <a href="https://imr.brage.unit.no/imr-xmlui/bitstream/handle/11250/2408609/FoH_2-2016.pdf?sequence=1&amp;isAllowed=y" class="external-link">https://imr.brage.unit.no/imr-xmlui/bitstream/handle/11250/2408609/FoH_2-2016.pdf?sequence=1&amp;isAllowed=y</a>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Andy Beet, Sean Lucey, Sarah Gaichas, Kiersten Curti.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
