<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mskeyrun">
<title>Georges Bank Survey Biomass and Catch Data • mskeyrun</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Georges Bank Survey Biomass and Catch Data">
<meta property="og:description" content="mskeyrun">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mskeyrun</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/mskeyrun.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Data Needs</h6>
    <a class="dropdown-item" href="../articles/DataNeeds.html">Project outline</a>
    <a class="dropdown-item" href="../articles/DatasetDimensions.html">Dataset Dimensions</a>
    <a class="dropdown-item" href="../articles/SpeciesEnvDat.html">Keyrun Species, Environment, Data Formats</a>
    <a class="dropdown-item" href="../articles/CompsDat.html">Age, Length, Diet</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Georges Bank</h6>
    <a class="dropdown-item" href="../articles/GBSurveySet.html">GB Survey Footprint</a>
    <a class="dropdown-item" href="../articles/allocateLandingsEPU.html">Allocate Landings to GB</a>
    <a class="dropdown-item" href="../articles/stockAreas.html">Stock areas</a>
    <a class="dropdown-item" href="../articles/GBsurveycatchviz.html">Focal species biomass and catch on GB</a>
    <a class="dropdown-item" href="../articles/GBdietcomp.html">Focal species diets on GB</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Simulated Data</h6>
    <a class="dropdown-item" href="../articles/SimData.html">Generating Simulated Data</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Assigning Fleets</h6>
    <a class="dropdown-item" href="../articles/GBFleetDefinitions.html">Analysis of catch by gear</a>
    <a class="dropdown-item" href="../articles/GBFleetDecisions.html">Fleet Definitions</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Length &amp; Age Based Data</h6>
    <a class="dropdown-item" href="../articles/GBLandingLengthDataSources.html">Data Sources</a>
    <a class="dropdown-item" href="../articles/GBLandingsByLength.html">Landings by Length</a>
    <a class="dropdown-item" href="../articles/GBLandingsByAge.html">Landings by Age</a>
    <a class="dropdown-item" href="../articles/GBLengthWeight.html">Length Weight Relationships</a>
    <a class="dropdown-item" href="../articles/GBbiomassNumbyLength.html">Survey Biomass and Abundance</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/NOAA-EDAB/ms-keyrun/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="GBsurveycatchviz_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Georges Bank Survey Biomass and Catch Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NOAA-EDAB/ms-keyrun/blob/HEAD/vignettes/GBsurveycatchviz.Rmd" class="external-link"><code>vignettes/GBsurveycatchviz.Rmd</code></a></small>
      <div class="d-none name"><code>GBsurveycatchviz.Rmd</code></div>
    </div>

    
    
<p>All models use a fishery independent index of biomass and a catch time series. This document visualizes these basic assessment inputs.</p>
<div class="section level2">
<h2 id="fishery-independent-survey-indices">Fishery independent survey indices<a class="anchor" aria-label="anchor" href="#fishery-independent-survey-indices"></a>
</h2>
<p>The NEFSC spring and fall <a href="https://noaa-edab.github.io/tech-doc/" class="external-link">bottom trawl surveys</a> collect the information required to obtain estimates of survey biomass and abundance. R package <a href="https://noaa-edab.github.io/survdat/" class="external-link"><code>survdat</code></a> was used to pull and compile the survey data time series. NEFSC bottom-trawl sampling encompasses about 293,000 square km of continental shelf from Cape Hatteras, NC, to Nova Scotia, Canada in depths from 8-400 m.</p>
<p>Multiple survey datasets are provided in the <code>mskeyrun</code> package; all were created using <code>create_survey_index()</code> in <code>ms-keyrun/data-raw</code>. Datasets for the 10 Georges Bank focal species are <code><a href="../reference/surveyIndex.html">mskeyrun::surveyIndex</a></code> (all survey years 1968-2019 converted to survey vessel R/V Albatross units for years surveyed by R/V Henry Bigelow 2009-2019), and unconverted separate indices for Albatross years (<code><a href="../reference/surveyIndexA4.html">mskeyrun::surveyIndexA4</a></code>) and Bigelow years (<code><a href="../reference/surveyIndexHB.html">mskeyrun::surveyIndexHB</a></code>). Datasets for food web modeling include all surveyed species for combined and separate surveys. These datasets have the same names with the suffix -All appended (e.g. <code><a href="../reference/surveyIndexAll.html">mskeyrun::surveyIndexAll</a></code>)</p>
<p>Here we visualize survey indices from the <code><a href="../reference/surveyIndex.html">mskeyrun::surveyIndex</a></code> dataset.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modyears</span> <span class="op">&lt;-</span> <span class="fl">1968</span><span class="op">:</span><span class="fl">2019</span>  <span class="co"># 1968 agreed for project, testing with shorter dataset</span></span>
<span>  </span>
<span><span class="va">focalspp</span> <span class="op">&lt;-</span> <span class="fu">mskeyrun</span><span class="fu">::</span><span class="va"><a href="../reference/focalSpecies.html">focalSpecies</a></span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">modelName</span> <span class="op">!=</span> <span class="st">"Pollock"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># not using in these models</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Name <span class="op">=</span> <span class="va">modelName</span><span class="op">)</span> </span>
<span>    </span>
<span>    <span class="co"># single index, use if fitting to two not working</span></span>
<span><span class="va">survindex.all</span> <span class="op">&lt;-</span> <span class="fu">mskeyrun</span><span class="fu">::</span><span class="va"><a href="../reference/surveyIndex.html">surveyIndex</a></span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">YEAR</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">modyears</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">focalspp</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">NESPP3</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">modelName</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ModSim <span class="op">=</span> <span class="st">"Actual"</span>,</span>
<span>                    year <span class="op">=</span> <span class="va">YEAR</span>,</span>
<span>                    Code <span class="op">=</span> <span class="va">SPECIES_ITIS</span>,</span>
<span>                    Name <span class="op">=</span> <span class="va">modelName</span>,</span>
<span>                    survey <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Combined "</span>, <span class="va">SEASON</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ModSim</span>, <span class="va">year</span>, <span class="va">Code</span>, <span class="va">Name</span>, <span class="va">survey</span>, <span class="va">variable</span>, <span class="va">value</span>, <span class="va">units</span><span class="op">)</span></span>
<span>    </span>
<span><span class="va">towarea</span> <span class="op">&lt;-</span> <span class="fl">0.0384</span></span>
<span>    </span>
<span><span class="va">GBsurvstrata</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1090</span>, <span class="fl">1130</span><span class="op">:</span><span class="fl">1210</span>, <span class="fl">1230</span>, <span class="fl">1250</span>, <span class="fl">3460</span>, <span class="fl">3480</span>, <span class="fl">3490</span>, <span class="fl">3520</span><span class="op">:</span><span class="fl">3550</span><span class="op">)</span></span>
<span>    </span>
<span><span class="va">GBarea</span> <span class="op">&lt;-</span> <span class="fl">55055.24</span> <span class="co">#FishStatsUtils::northwest_atlantic_grid %&gt;%</span></span>
<span>      <span class="co">#dplyr::filter(stratum_number %in% GBsurvstrata) %&gt;%</span></span>
<span>      <span class="co">#dplyr::summarise(area = sum(Area_in_survey_km2)) %&gt;%</span></span>
<span>      <span class="co">#as.double()</span></span>
<span></span>
<span><span class="va">survbio</span> <span class="op">&lt;-</span> <span class="va">survindex.all</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"strat.biomass"</span>, <span class="st">"biomass.var"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">units</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"variable"</span>, values_from <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">biomass.var</span><span class="op">)</span><span class="op">/</span><span class="va">strat.biomass</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">biomass.var</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="co"># expand: area of tow =  0.0384 and GB area = above and kg to tons</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>biomass <span class="op">=</span> <span class="va">strat.biomass</span> <span class="op">*</span> <span class="op">(</span><span class="va">GBarea</span><span class="op">/</span><span class="va">towarea</span><span class="op">)</span> <span class="op">/</span><span class="fl">1000</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">biomass</span>, <span class="va">cv</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"variable"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">variable</span><span class="op">==</span><span class="st">"biomass"</span>, <span class="st">"tons"</span>, <span class="st">"unitless"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot biomass time series facet wrapped by species</span></span>
<span><span class="va">plotB</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dat</span>, <span class="va">truedat</span><span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>    <span class="va">svbio</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable</span><span class="op">==</span><span class="st">"biomass"</span><span class="op">)</span></span>
<span>    <span class="va">svcv</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable</span><span class="op">==</span><span class="st">"cv"</span><span class="op">)</span></span>
<span>  </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">svbio</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">year</span>,y<span class="op">=</span><span class="va">value</span>, color<span class="op">=</span><span class="st">"Survey Biomass"</span><span class="op">)</span>, </span>
<span>              alpha <span class="op">=</span> <span class="fl">10</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="op">{</span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">truedat</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">truedat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span><span class="op">/</span><span class="fl">365</span>,y<span class="op">=</span><span class="va">atoutput</span>, color<span class="op">=</span><span class="st">"True B"</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">3</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span><span class="op">}</span> <span class="op">+</span> </span>
<span>    <span class="fu">theme_tufte</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"model year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"tons"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>colour<span class="op">=</span><span class="va">dat</span><span class="op">$</span><span class="va">ModSim</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Name</span>, scales<span class="op">=</span><span class="st">"free"</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="kw">for</span><span class="op">(</span><span class="va">s</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">survbio</span><span class="op">$</span><span class="va">survey</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n##### "</span>,  <span class="va">s</span>,<span class="st">"  \n"</span><span class="op">)</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">plotB</span><span class="op">(</span><span class="va">survbio</span> <span class="op">%&gt;%</span></span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">(</span><span class="va">survey</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">s</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  \n"</span><span class="op">)</span></span>
<span> <span class="op">}</span></span></code></pre></div>
<div class="section level5">
<h5 id="combined-fall">Combined FALL<a class="anchor" aria-label="anchor" href="#combined-fall"></a>
</h5>
<p><img src="GBsurveycatchviz_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
</div>
<div class="section level5">
<h5 id="combined-spring">Combined SPRING<a class="anchor" aria-label="anchor" href="#combined-spring"></a>
</h5>
<p><img src="GBsurveycatchviz_files/figure-html/unnamed-chunk-1-2.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="fishery-dependent-catch">Fishery dependent catch<a class="anchor" aria-label="anchor" href="#fishery-dependent-catch"></a>
</h2>
<p>Commercial landings and discards information is compiled with the R package <a href="https://noaa-edab.github.io/comlandr/index.html" class="external-link"><code>comlandr</code></a>.</p>
<p>Landings are proportioned from fishery statistical areas to Georges Bank using the proportion of landings within and outside Georges Bank from high resolution fishery data (see <a href="allocateLandingsEPU.html"> Allocate landings to EPU</a>).</p>
<p>Discard rates (discarded/kept weight) are estimated from fishery observer data for each species and gear for years with observer information. Prior years discard rates are based on the average across years with observer information for each species and gear. The annual discard rate is multiplied by the Georges Bank landings time series to estimate the discards time series.</p>
<p><em>Discard mortality rates have not yet been applied</em></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="va">fleetdef</span> <span class="op">&lt;-</span> <span class="va">focalspp</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">NESPP3</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>species <span class="op">=</span> <span class="va">Name</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pelagic <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">species</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Atlantic_herring"</span>,</span>
<span>                                                              <span class="st">"Atlantic_mackerel"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">2</span>,</span>
<span>                                               <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>                    demersal <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="op">!</span><span class="va">species</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Atlantic_herring"</span>,</span>
<span>                                                                <span class="st">"Atlantic_mackerel"</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                                                <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>                    qind <span class="op">=</span> <span class="va">pelagic</span> <span class="op">+</span> <span class="va">demersal</span>,</span>
<span>                    pelagic <span class="op">=</span> <span class="va">pelagic</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">demersal</span>, <span class="va">pelagic</span>, <span class="va">qind</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># need to have landings + discards = catch</span></span>
<span>    <span class="va">fishindex</span> <span class="op">&lt;-</span> <span class="fu">mskeyrun</span><span class="fu">::</span><span class="va"><a href="../reference/catchIndex.html">catchIndex</a></span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">YEAR</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">modyears</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">focalspp</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>NESPP3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">NESPP3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Name</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">units</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"variable"</span>, values_from <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">YEAR</span>, <span class="va">Name</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>catch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">`commercial landings`</span>,<span class="va">`commercial discards`</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                    cv <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">`commercial landings`</span>, <span class="va">`commercial discards`</span>, <span class="va">catch</span>, <span class="va">cv</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"variable"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">variable</span><span class="op">==</span><span class="st">"cv"</span>, <span class="st">"unitless"</span>, <span class="st">"metric tons"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">fleetdef</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Name"</span> <span class="op">=</span> <span class="st">"species"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ModSim <span class="op">=</span> <span class="st">"Actual"</span>,</span>
<span>                    year <span class="op">=</span> <span class="va">YEAR</span>,</span>
<span>                    Code <span class="op">=</span> <span class="va">SPECIES_ITIS</span>,</span>
<span>                    Name <span class="op">=</span> <span class="va">modelName</span>,</span>
<span>                    fishery <span class="op">=</span> <span class="va">qind</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ModSim</span>, <span class="va">year</span>, <span class="va">Code</span>, <span class="va">Name</span>, <span class="va">fishery</span>, <span class="va">variable</span>, <span class="va">value</span>, <span class="va">units</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make a catch series function that can be split by fleet? this doesnt</span></span>
<span><span class="co"># also note different time (days) from model timestep in all other output</span></span>
<span><span class="va">plotC</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dat</span>, <span class="va">truedat</span><span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>    <span class="va">ctbio</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable</span><span class="op">==</span><span class="st">"catch"</span><span class="op">)</span></span>
<span>    <span class="va">ctcv</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable</span><span class="op">==</span><span class="st">"cv"</span><span class="op">)</span></span>
<span>    <span class="va">landdisc</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">variable</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"commercial landings"</span>, <span class="st">"commercial discards"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">landdisc</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">year</span>,y<span class="op">=</span><span class="va">value</span>, colour<span class="op">=</span><span class="va">variable</span><span class="op">)</span>, </span>
<span>              alpha <span class="op">=</span> <span class="fl">10</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="op">{</span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">truedat</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">truedat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span><span class="op">/</span><span class="fl">365</span>,y<span class="op">=</span><span class="va">atoutput</span>, color<span class="op">=</span><span class="st">"True Catch"</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">3</span><span class="op">/</span><span class="fl">10</span><span class="op">)</span><span class="op">}</span> <span class="op">+</span> </span>
<span>    <span class="fu">theme_tufte</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"model year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"tons"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>colour<span class="op">=</span><span class="va">dat</span><span class="op">$</span><span class="va">ModSim</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Name</span>, scales<span class="op">=</span><span class="st">"free"</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">plotC</span><span class="op">(</span><span class="va">fishindex</span><span class="op">)</span></span></code></pre></div>
<p><img src="GBsurveycatchviz_files/figure-html/catch-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Andy Beet, Sean Lucey, Sarah Gaichas, Kiersten Curti.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
