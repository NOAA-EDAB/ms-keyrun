---
title: "MS Keyrun Species, Environment, Data Formats"
author: "Sarah Gaichas"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    code_fold: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      message = FALSE,
                      warning = FALSE)

library(googledrive)
library(pacman)
p_load(repmis, RCurl, DT, magrittr, gsubfn, stringr, tidyverse)

```

## Species lists

### Multispecies models (focal species)

Multispecies models focus on a subset of interacting species. They will estimate population parameters based on fits to biomass, catch, and (if appropriate) size or age information, establish reference points, and evaluate status for the interacting species.

### Food web model (focal + rest of system)

The food web model is intended to examine wider ecosystem responses to management measures applied to a subset of interacting species. It will estimate predator-prey interaction and other parameters based on fits to biomass, catch, and diet information. This model should track general trends (if not interannual variability) for focal species and produce reasonable reactions by their predators and prey.

Current species groups in the GB Rpath model:
```{r rpathspp}

# Sean's file from https://github.com/NOAA-EDAB/GBRpath/blob/master/data/SOE_species_list.RData
# loads the RData as object "species"

source_data("https://github.com/NOAA-EDAB/GBRpath/blob/master/data/SOE_species_list.RData?raw=True")

# used to get a list to paste into google form
#write.table(file = "spplist.txt", sort(unique(species$RPATH)))

rpathspp <- species %>%
  select(RPATH, COMNAME, SCINAME, SVSPP) %>%
  distinct() 

  #count(SVSPP, RPATH, sort = TRUE, name = "Nspp")

datatable(rpathspp, rownames = FALSE, options = list(pageLength = 25))

```


## Envrionmental data

### Multispecies models

### Food web model

## Programming frameworks and data formats

## Full survey results

### Survey conducted July 13-24 2020

[This is the survey form.](https://forms.gle/gfA3tKFKRBxf3Mu38)

### REVISE BELOW HERE FOR UPDATED SURVEY

```{r getsurvey, eval=FALSE}

#survey link https://forms.gle/gfA3tKFKRBxf3Mu38
#results 

resultfile <- drive_find(pattern = "MS-Keyrun Species", type = "spreadsheet")

responses <- drive_download(resultfile, type = "csv", overwrite = TRUE) %>%
  {read.csv(.$local_path)} 

names(responses)[3] <- "StartYear"
names(responses)[5] <- "EndYear"
names(responses)[7] <- "SurvSeason"
names(responses)[9] <- "FishSeason"
names(responses)[11] <- "SpatialGB"

```

We had `r nrow(responses)` responses.

### Years (start-end)

Responses:
```{r}
startend <- data.frame(Start = responses$StartYear,
                       End = responses$EndYear)
knitr::kable(startend, booktabs=TRUE)
```


```{r} 
knitr::kable(responses$Rationale.for.start.time, col.names = "Start year rationale", booktabs=TRUE)
```


```{r}
knitr::kable(responses$Rationale.for.end.time, col.names = "End year rationale", booktabs=TRUE)
```

### Seasons (fall/spring surveys? fishery seasons?)

Responses:
```{r seasons}

seasons <- responses %>%
  select(SurvSeason, FishSeason) %>%
  gather(key = SurvFish, value = "Season") %>%
  arrange(Season)

ggplot(seasons, aes(Season, fill=SurvFish)) + 
  geom_bar() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 15))#+ 
  #theme(axis.text.x = element_text(angle = 90))
  
```


```{r} 
knitr::kable(responses$Rationale.for.survey.temporal.resolution, col.names = "Survey season rationale", booktabs=TRUE)
```


```{r} 
knitr::kable(responses$Rationale.for.fishery.temporal.resolution, col.names = "Fishery season rationale", booktabs=TRUE)
```


### Spatial footprint (Georges Bank defined how)

Responses:
```{r space}

ggplot(responses, aes(SpatialGB)) + 
  geom_bar() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 35))#+ 


```


```{r} 
knitr::kable(responses$Rationale.for.spatial.definition, col.names = "Spatial Rationale", booktabs=TRUE)
```

## Meeting minutes

[Click here!](https://docs.google.com/document/d/19FpJ8w2a-ZZ8ZY4ZmsnjlIilLeN1X9_Tz1dM-KsdOOw/edit#heading=h.kvnvc0pxyvqq)